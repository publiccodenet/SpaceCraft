# SpaceCraft Custom Metadata System

## Overview

The custom metadata system enhances SpaceCraft items with additional metadata and high-quality cover images. It supports both overlaying custom data on Internet Archive items and creating fully custom items that don't exist in the Internet Archive.

## Current Implementation Status

⚠️ **Note**: The custom metadata system from the don-searcher branch has NOT yet been integrated into the current pipeline.js. The pipeline currently only supports basic Internet Archive imports without custom overlay support.

## Types of Custom Content

### 1. Enhanced IA Items
Add custom metadata to existing Internet Archive items while preserving the original data through deep merge.

### 2. Custom Cover Images
Replace low-quality IA thumbnails with high-resolution cover images.

### 3. Fully Custom Items
Create items that don't exist in the Internet Archive with `custom_item: true` flag.

## File Structure

```
Content/collections/scifi/items/
├── itemid/
│   ├── item.json           # Generated by pipeline
│   ├── item-custom.json    # Your custom metadata (optional)
│   ├── cover.jpg          # Downloaded from IA (optional)
│   └── cover-custom.jpg   # Your custom cover (optional)
```

## Custom Metadata Format

### item-custom.json (Overlay for IA Items)

```json
{
  "title": "Enhanced Title",
  "author": "Author Name", 
  "publication_year": 1968,
  "genre": "Cyberpunk",
  "description": "A compelling enhanced description that provides more context...",
  "cosmic_significance": "Why this book matters in the grand scheme",
  "excitement_level": 9,
  "reading_experience": "What it's like to read this book",
  "visual_elements": ["Spaceships", "Alien worlds", "Time portals"],
  "adventure_rating": 7,
  "themes": [
    "Artificial consciousness",
    "Environmental collapse", 
    "Corporate dystopia"
  ],
  "spaceCraftTags": [
    "must-read",
    "cyberpunk",
    "philosophical",
    "award-winner"
  ]
}
```

### Fully Custom Item

For items not in Internet Archive, create an item.json with `custom_item: true`:

```json
{
  "custom_item": true,
  "id": "custom-book-id",
  "title": "My Custom Book",
  "author": "Custom Author",
  "description": "A book that doesn't exist in IA",
  "coverImage": "cover-custom.jpg",
  "mediatype": "texts",
  "subject": ["Science Fiction", "Custom"],
  "collection": ["scifi"]
}
```

## Implementation Plan

### Phase 1: Pipeline Integration
The don-searcher branch includes the necessary code to support custom metadata:

```javascript
// Check for custom overlay data
const customItemJsonPath = path.join(itemPath, 'item-custom.json');
if (fs.existsSync(customItemJsonPath)) {
    const customData = await fs.readJson(customItemJsonPath);
    _.merge(itemData, customData); // Deep merge preserves IA data
}

// Check for custom cover
const customCoverPath = path.join(itemPath, 'cover-custom.jpg');
if (fs.existsSync(customCoverPath)) {
    await fs.copyFile(customCoverPath, path.join(exportPath, 'cover.jpg'));
} else {
    // Download from IA as usual
}
```

### Phase 2: Search System Integration
- Export aggregated spaceCraftTags to index-deep.json
- Share tags via Supabase state from spacecraft.js
- Enable `#tag` prefix searching in controllers
- Implement tag selection UI in controllers

### Phase 3: Content Creation
Examples from don-searcher branch to migrate:
- `doandroidsdreamo00dick_0/item-custom.json` - Enhanced Philip K. Dick
- `fulgrim_202211/item-custom.json` - Custom Warhammer 40K book
- `gigant-manga/item-custom.json` - Fully custom manga entry
- `thedispossessed0000legu/cover-custom.jpg` - High-quality cover

## Custom Cover Images

### Requirements
- Filename: `cover-custom.jpg`
- Format: JPEG (for smaller file size)
- Dimensions: ~300x450px (3:2 aspect ratio)
- Quality: High resolution, clear text

### How It Works
1. Pipeline checks for `cover-custom.jpg` first
2. If found, copies it as `cover.jpg` to Unity
3. If not found, downloads from Internet Archive
4. Unity only sees `cover.jpg` (no code changes needed)

## Best Practices

### 1. Enhanced Descriptions
- Keep original IA description if valuable
- Add compelling context and significance
- Mention key themes and visual elements
- Target 2-3 engaging sentences
- LLM generated high quality spaceCraftDescription

### 2. Metadata Fields
- **cosmic_significance**: Why this matters in the universe
- **excitement_level**: 1-10 rating for adventure/action
- **visual_elements**: Key imagery and scenes
- **themes**: Core philosophical concepts explored
- **spaceCraftTags**: Searchable keywords
- **spaceCraftDescription**: High quality uniform length description

### 3. Tags (spaceCraftTags)
- Use lowercase with hyphens (e.g., "hard-sci-fi")
- Be consistent across the collection
- Include: genre, themes, awards, mood
- Limit to 5-10 most relevant tags

## Example Enhancements

### Do Androids Dream of Electric Sheep?
```json
{
  "title": "Do Androids Dream of Electric Sheep?",
  "author": "Dick, Philip K.",
  "publication_year": 1968,
  "description": "In post-apocalyptic San Francisco, bounty hunter Rick Deckard hunts rogue androids while questioning what it means to be human in a world where empathy is manufactured and electric sheep graze on rooftops.",
  "cosmic_significance": "The philosophical foundation that spawned Blade Runner and defined our anxieties about artificial consciousness",
  "excitement_level": 7,
  "themes": [
    "What defines humanity",
    "Artificial empathy",
    "Environmental collapse",
    "Religious simulacra"
  ],
  "spaceCraftDescription": "Like wow, man, what more is there to say about this book that hasn't been said?",
  "spaceCraftTags": [
    "cyberpunk-origin",
    "philosophical",
    "blade-runner",
    "must-read",
    "empathy-box"
  ]
}
```

### Custom Manga Example (Fully Custom)
```json
{
  "custom_item": true,
  "id": "gigant-manga",
  "title": "GIGANT",
  "author": "Oku, Hiroya",
  "description": "When a porn actress gains the power to grow to enormous size, Tokyo becomes the stage for bizarre kaiju-scale drama mixing size fetishism with existential dread.",
  "genre": "Sci-Fi Manga",
  "visual_elements": ["Giant woman", "City destruction", "Size contrast", "Surreal imagery"],
  "excitement_level": 8,
  "themes": [
    "Power and vulnerability",
    "Public vs private identity",
    "Scale and perspective"
  ],
  "spaceCraftDescription": "Like wow, man, what more is there to say about this manga that hasn't been said?",
  "spaceCraftTags": [
    "manga",
    "kaiju",
    "surreal",
    "size-changing",
    "oku-hiroya"
  ]
}
```

## Testing Your Custom Content

1. Add custom files to `Content/collections/scifi/items/[itemid]/`
2. Run pipeline: `npm run pipeline -- --collection scifi`
3. Check generated files in Unity StreamingAssets
4. Verify in Unity:
   - Custom metadata appears in item details
   - Custom covers display properly
   - Tags are searchable

## Troubleshooting

### Custom data not appearing
- Pipeline doesn't yet support custom metadata (use don-searcher branch)
- Check file paths match exactly: `item-custom.json`
- Validate JSON syntax with online tool
- Run pipeline with --verbose flag

### Cover not updating
- Clear Unity asset cache
- Verify filename is exactly `cover-custom.jpg`
- Check image isn't corrupted
- Ensure ~300x450px dimensions

### Pipeline errors
- Current pipeline.js lacks custom support
- Use lodash for deep merge operations
- Ensure item IDs match directory names 
