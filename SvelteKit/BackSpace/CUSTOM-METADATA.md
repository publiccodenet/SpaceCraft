# SpaceCraft Custom Metadata System

## Overview

The custom metadata system enhances SpaceCraft items with additional metadata and high-quality cover images. It supports both overlaying custom data on Internet Archive items and creating fully custom items that don't exist in the Internet Archive.

## Current Implementation Status

⚠️ **Note**: The custom metadata system from the don-searcher branch has NOT yet been integrated into the current pipeline.js. The pipeline currently only supports basic Internet Archive imports without custom overlay support.

## Types of Custom Content

### 1. Fully Custom Items (Not from Internet Archive)
Create items that don't exist in the Internet Archive:
- Use `item.json` directly with `"spacecraft_custom_item": true` flag
- The importer will NOT replace these items
- Can still have an `item-custom.json` overlay for additional enhancements

### 2. Enhanced IA Items
Add custom metadata to existing Internet Archive items:
- Use `item-custom.json` to overlay additional data
- Original IA data is preserved through deep merge
- Perfect for adding keywords, better descriptions, themes, etc.

### 3. Custom Cover Images
Replace low-quality IA thumbnails with high-resolution cover images:
- Use `cover-custom.jpg` for any item type
- Pipeline prioritizes custom covers over IA downloads

## File Structure

```
Content/collections/scifi/items/
├── itemid/
│   ├── item.json           # Generated by pipeline
│   ├── item-custom.json    # Your custom metadata (optional)
│   ├── cover.jpg          # Downloaded from IA (optional)
│   └── cover-custom.jpg   # Your custom cover (optional)
```

## When to Use Which File

### Use `item.json` when:
- Creating a fully custom item (not from Internet Archive)
- The item should include `"spacecraft_custom_item": true`
- You want complete control over all metadata
- Keep this minimal - just core fields

### Use `item-custom.json` when:
- Enhancing an existing Internet Archive item
- Adding keywords, better descriptions, themes to imported items
- **ALL LLM-generated content should go here**
- Even works on custom items for additional overlays!

## SpaceCraft Metadata Convention

**Important**: To avoid namespace collisions and make LLM editing easier, we use the `spacecraft_` prefix for all enhanced metadata fields in `item-custom.json`:

- `spacecraft_description` - Enhanced description (UI prefers this over `description`)
- `spacecraft_tags` - Searchable keywords/tags
- `spacecraft_themes` - Core themes explored
- `spacecraft_visual_elements` - Key imagery
- `spacecraft_cosmic_significance` - Why this matters
- `spacecraft_custom_url` - Custom URL for inspector (overrides Internet Archive URL)
- Any other spacecraft_ prefixed fields

This convention ensures:
1. No collision with Internet Archive metadata
2. No collision with user's custom metadata
3. Clear separation of LLM-generated content
4. Easy for LLMs to create/edit item-custom.json files
5. UI knows to prefer spacecraft_ fields when available

## Custom Metadata Format

### item-custom.json (LLM-Generated Enhancements)

```json
{
  "spacecraft_description": "A compelling enhanced description that provides more context and excitement about this work...",
  "spacecraft_cosmic_significance": "Why this book matters in the grand scheme of the universe",
  "spacecraft_excitement_level": 9,
  "spacecraft_reading_experience": "What it's like to read this book - the journey you'll take",
  "spacecraft_visual_elements": ["Spaceships", "Alien worlds", "Time portals"],
  "spacecraft_adventure_rating": 7,
  "spacecraft_themes": [
    "Artificial consciousness",
    "Environmental collapse", 
    "Corporate dystopia"
  ],
  "spacecraft_tags": [
    "must-read",
    "cyberpunk",
    "philosophical",
    "award-winner"
  ],
  "spacecraft_genre": "Cyberpunk",
  "spacecraft_publication_year": 1968
}
```

### Fully Custom Item (item.json)

For items not in Internet Archive, create an `item.json` with `"spacecraft_custom_item": true`:

```json
{
  "spacecraft_custom_item": true,
  "id": "gigant-manga",
  "title": "GIGANT",
  "author": "Oku, Hiroya",
  "description": "When a porn actress gains the power to grow to enormous size...",
  "coverImage": "cover.jpg",
  "mediatype": "texts",
  "subject": ["Science Fiction", "Manga"],
  "collection": ["scifi"],
  "genre": "Sci-Fi Manga",
  "visual_elements": ["Giant woman", "City destruction"],
  "spacecraft_tags": ["manga", "kaiju", "surreal"]
}
```

**Important**: The `"spacecraft_custom_item": true` flag prevents the importer from replacing this file. You can still add an `item-custom.json` to overlay additional metadata (like LLM-generated keywords) on top of this base definition.

## Implementation Plan

### Phase 1: Pipeline Integration
The don-searcher branch includes the necessary code to support custom metadata:

```javascript
// Check for custom overlay data
const customItemJsonPath = path.join(itemPath, 'item-custom.json');
if (fs.existsSync(customItemJsonPath)) {
    const customData = await fs.readJson(customItemJsonPath);
    _.merge(itemData, customData); // Deep merge preserves IA data
}

// Check for custom cover
const customCoverPath = path.join(itemPath, 'cover-custom.jpg');
if (fs.existsSync(customCoverPath)) {
    await fs.copyFile(customCoverPath, path.join(exportPath, 'cover.jpg'));
} else {
    // Download from IA as usual
}
```

### Phase 2: Search System Integration
- Export aggregated spacecraft_tags to index-deep.json
- Share tags via Supabase state from spacecraft.js
- Enable `#tag` prefix searching in controllers
- Implement tag selection UI in controllers

### Phase 3: Content Creation
Examples from don-searcher branch to migrate:
- `doandroidsdreamo00dick_0/item-custom.json` - Enhanced Philip K. Dick
- `fulgrim_202211/item-custom.json` - Custom Warhammer 40K book
- `gigant-manga/item-custom.json` - Fully custom manga entry
- `thedispossessed0000legu/cover-custom.jpg` - High-quality cover

## Custom Cover Images

### Requirements
- Filename: `cover-custom.jpg`
- Format: JPEG (for smaller file size)
- Dimensions: ~300x450px (3:2 aspect ratio)
- Quality: High resolution, clear text

### How It Works
1. Pipeline checks for `cover-custom.jpg` first
2. If found, copies it as `cover.jpg` to Unity
3. If not found, downloads from Internet Archive
4. Unity only sees `cover.jpg` (no code changes needed)

## Best Practices

### 1. Enhanced Descriptions
- Keep original IA description if valuable
- Add compelling context and significance
- Mention key themes and visual elements
- Target 2-3 engaging sentences
- LLM generated high quality spacecraft_description

### 2. Metadata Fields (All in item-custom.json with spacecraft_ prefix)
- **spacecraft_cosmic_significance**: Why this matters in the universe
- **spacecraft_excitement_level**: 1-10 rating for adventure/action
- **spacecraft_visual_elements**: Key imagery and scenes
- **spacecraft_themes**: Core philosophical concepts explored
- **spacecraft_tags**: Searchable keywords
- **spacecraft_description**: High quality uniform length description
- **spacecraft_genre**: Genre classification
- **spacecraft_mood**: Emotional tone of the work
- **spacecraft_pacing**: Story pacing (slow-burn, breakneck, etc.)
- **spacecraft_custom_url**: Custom URL for inspector (e.g., author's website, Wikipedia, custom reader)

### 3. Tags (spacecraft_tags)
- Use lowercase with hyphens (e.g., "hard-sci-fi")
- Be consistent across the collection
- Include: genre, themes, awards, mood
- Limit to 5-10 most relevant tags

## Using spacecraft_custom_url

The `spacecraft_custom_url` field allows you to override the default Internet Archive URL in the inspector:

```json
{
  "spacecraft_custom_url": "https://www.ursulakleguinarchive.com/dispossessed",
  // ... other spacecraft_ fields
}
```

Common use cases:
- Author's official website
- Wikipedia article for context
- Custom web-based reader or viewer
- Educational resources
- Video essays or documentaries about the work
- Interactive experiences related to the content

## Example Enhancements

### Do Androids Dream of Electric Sheep? (item-custom.json)
```json
{
  "spacecraft_description": "In post-apocalyptic San Francisco, bounty hunter Rick Deckard hunts rogue androids while questioning what it means to be human in a world where empathy is manufactured and electric sheep graze on rooftops.",
  "spacecraft_cosmic_significance": "The philosophical foundation that spawned Blade Runner and defined our anxieties about artificial consciousness",
  "spacecraft_excitement_level": 7,
  "spacecraft_themes": [
    "What defines humanity",
    "Artificial empathy",
    "Environmental collapse",
    "Religious simulacra"
  ],
  "spacecraft_tags": [
    "cyberpunk-origin",
    "philosophical",
    "blade-runner",
    "must-read",
    "empathy-box"
  ],
  "spacecraft_genre": "Proto-Cyberpunk",
  "spacecraft_mood": "Existential dread mixed with noir detective",
  "spacecraft_pacing": "Methodical with bursts of action",
  "spacecraft_custom_url": "https://en.wikipedia.org/wiki/Do_Androids_Dream_of_Electric_Sheep%3F"
}
```

### Hybrid Example: Custom Item with Overlay

Base `item.json` (core metadata):
```json
{
  "spacecraft_custom_item": true,
  "id": "neuromancer-interactive",
  "title": "Neuromancer: Interactive Edition",
  "author": "Gibson, William",
  "description": "A custom interactive version of the cyberpunk classic",
  "mediatype": "texts",
  "collection": ["scifi"],
  "coverImage": "cover.jpg"
}
```

Additional `item-custom.json` (LLM-generated enhancements):
```json
{
  "spacecraft_cosmic_significance": "The digital Rosetta Stone that taught us to dream in binary",
  "spacecraft_excitement_level": 9,
  "spacecraft_visual_elements": [
    "Matrix-like digital rain",
    "Neon-lit Chiba City",
    "Corporate arcologies",
    "Cyberspace geometries"
  ],
  "spacecraft_themes": [
    "AI consciousness emergence",
    "Body-mind dualism",
    "Corporate dystopia",
    "Digital transcendence"
  ],
  "spacecraft_tags": [
    "cyberpunk-essential",
    "matrix-inspiration",
    "interactive-fiction",
    "ai-awakening",
    "console-cowboy"
  ],
  "spacecraft_description": "Case was the sharpest data-thief in the matrix, until he crossed the wrong people. Now, rebuilt with street surgery and a death wish, he's about to jack into the most dangerous run of his life.",
  "spacecraft_genre": "Cyberpunk",
  "spacecraft_mood": "Neon-noir adrenaline"
}
```

## Testing Your Custom Content

1. Add custom files to `Content/collections/scifi/items/[itemid]/`
2. Run pipeline: `npm run pipeline -- --collection scifi`
3. Check generated files in Unity StreamingAssets
4. Verify in Unity:
   - Custom metadata appears in item details
   - Custom covers display properly
   - Tags are searchable

## Troubleshooting

### Custom data not appearing
- Pipeline doesn't yet support custom metadata (use don-searcher branch)
- Check file paths match exactly: `item-custom.json`
- Validate JSON syntax with online tool
- Run pipeline with --verbose flag

### Cover not updating
- Clear Unity asset cache
- Verify filename is exactly `cover-custom.jpg`
- Check image isn't corrupted
- Ensure ~300x450px dimensions

### Pipeline errors
- Current pipeline.js lacks custom support
- Use lodash for deep merge operations
- Ensure item IDs match directory names 
