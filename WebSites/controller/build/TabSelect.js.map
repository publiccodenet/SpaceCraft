{"version":3,"file":"TabSelect.js","sourceRoot":"","sources":["../src/TabSelect.ts"],"names":[],"mappings":"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","sourcesContent":["import { h1, h2, p, Register, div, img, h4, ListenerDefinition } from 'io-gui';\nimport { magnetJoystick, MagnetJoystick } from './MagnetJoystick.js';\nimport { TabBase, TabBaseProps } from './TabBase.js';\n\nconst GESTURE_THRESHOLD = 20;\n\n@Register\nexport class TabSelect extends TabBase {\n    static get Style() {\n        return /* css */`\n            :host {\n                text-align: justify;\n                display: flex;\n                flex-direction: column;\n                overflow: hidden;  /* let inner container scroll */\n                min-height: 0;     /* critical for flex scrolling */\n                height: 100%;      /* fill available space inside io-selector */\n            }\n            :host .content {\n                display: flex;\n                flex-direction: column;\n                gap: 0.75em;\n                overflow: auto;    /* scrolling container */\n                min-height: 0;\n                flex: 1 1 auto;\n                height: 100%;\n                max-height: calc(100vh - 180px); /* viewport constraint to force scroll */\n                -webkit-overflow-scrolling: touch;\n                padding: 0.25em 0.25em 0.5em 0.25em;\n            }\n            :host .top-row {\n                display: flex;\n                align-items: flex-start;      /* top-justify both */\n                justify-content: space-between;\n                gap: 1em;\n            }\n            :host .top-row .cover {\n                flex: 0 0 auto;\n                max-width: 45vw;\n            }\n            :host .cover-image {\n                pointer-events: none;\n                display: block;\n                max-width: 100%;\n                height: auto;\n            }\n            :host .top-row .joy-col {\n                flex: 0 0 auto;\n                display: flex;\n                flex-direction: column;\n                align-items: flex-end;\n                gap: 6px;\n            }\n            :host .joy-frame {\n                background: var(--io_bgColor, #333);\n                padding: 5px;\n                border-radius: 6px;\n            }\n            :host .hint {\n                font-style: italic;\n                font-size: 0.9em;\n                text-align: right;\n                line-height: 1.2;\n                opacity: 0.85;\n                align-self: flex-end; /* hard right-justify within the column */\n            }\n            :host h1.title {\n                margin: 0.15em 0 0.25em 0;\n                line-height: 1.2;\n                font-size: 1.8em;   /* larger item title */\n                text-align: left;\n            }\n        `;\n    }\n\n    declare startX: number;\n    declare startY: number;\n\n    static get Listeners() {\n        return {\n            'pointerdown': 'onPointerdown',\n        };\n    }\n\n    preventDefault(event: Event) {\n        event.preventDefault();\n    }\n    onPointerdown(event: PointerEvent) {\n        this.addEventListener('pointerup', this.onPointerup);\n        this.addEventListener('pointercancel', this.onPointerup);\n        this.startX = event.clientX;\n        this.startY = event.clientY;\n    }\n    onPointerup(event: PointerEvent) {\n        this.removeEventListener('pointerup', this.onPointerup);\n        this.removeEventListener('pointercancel', this.onPointerup);\n        const dx = event.clientX - this.startX;\n        const dy = event.clientY - this.startY;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n\n        let gesture = 'tap';\n        if (distance > GESTURE_THRESHOLD) {\n            if (Math.abs(dx) > Math.abs(dy)) {\n                gesture = dx > 0 ? 'east' : 'west';\n            } else {\n                gesture = dy > 0 ? 'south' : 'north';\n            }\n        }\n\n        switch (gesture) {\n        case 'tap': this.controller.sendSelectEvent('tap'); break;\n        case 'north': this.controller.sendSelectEvent('north'); break;\n        case 'south': this.controller.sendSelectEvent('south'); break;\n        case 'east': this.controller.sendSelectEvent('east'); break;\n        case 'west': this.controller.sendSelectEvent('west'); break;\n        }\n    }\n\n    changed() {\n        let description = 'No description available';\n        const selected = this.simulatorState?.selectedItem;\n        if (selected?.description) {\n            description = selected.description\n                .split(/\\n+/) // Split on any number of newlines\n                .filter((line: string) => line.trim().length > 0) // Remove empty lines\n                .map((line: string) => `<p>${line.trim()}</p>`) // Create paragraph for each line\n                .join('');\n        }\n\n        // Resolve cover base from content store (built-in StreamingAssets path or external)\n        const shared: any = (this.controller as any).simulatorState || {};\n        const assetsBase = (shared as any).assetsBaseUrl || '../SpaceCraft/StreamingAssets/Content/';\n\n        this.render([\n            div({class: 'content'}, [\n                selected.id ? div({class: 'top-row'}, [\n                    div({class: 'cover'}, [\n                        img({src: `${assetsBase}collections/scifi/items/${selected.id}/cover.jpg`, alt: `Cover for ${selected.title}`, class: 'cover-image'})\n                    ]),\n                    div({class: 'joy-col'}, [\n                        div({class: 'joy-frame'}, [\n                            magnetJoystick({class: 'joy', value: [0,0], min: [-0.1, -0.1], max: [0.1, 0.1], '@control': (e: CustomEvent) => this.onItemJoystickControl(e)})\n                        ]),\n                        div({class: 'hint', innerHTML: 'Joystick moves item.<br/>Swiping selects item.'})\n                    ])\n                ]) : null,\n                selected.id ? h1({class: 'title'}, selected.title || 'Untitled') : null,\n                selected.id ? div({class: 'description', innerHTML: description}) : p('No item selected')\n            ])\n        ]);\n    }\n\n    onItemJoystickControl(event: CustomEvent) {\n        const slider = event.target as MagnetJoystick;\n        const dx = slider.value[0];\n        const dy = slider.value[1];\n        const selected = (this as any).simulatorState?.selectedItem;\n        const id = selected?.id;\n        try {\n            console.log('[Controller][Select] joystick control', { id, dx, dy });\n        } catch {}\n        if (id) {\n            (this as any).controller?.sendPushItemEvent(id, dx, dy);\n        } else {\n            try { console.warn('[Controller][Select] No selected item id for joystick push'); } catch {}\n        }\n    }\n}\n\nexport const tabSelect = function(arg0: TabBaseProps) {\n    return TabSelect.vConstructor(arg0);\n};"]}